function locArrToTrackMate(loclist,saveName,pxsize)

% saveName = 'C:\Users\Koen Work\Desktop\text.xml';
% loclist = [1 2 2; 2 3 2; 2 6 7; 3 8 6;]; %loclist in frame-x-y, sizes in um
% pxsize = 0.100; %in um
nrlocs = size(loclist,1);
%only positive values
loclist(:,2) = loclist(:,2)-min(loclist(:,2));
loclist(:,3) = loclist(:,3)-min(loclist(:,3));
maxx = max(loclist(:,1));
maxy = max(loclist(:,2));

fid = fopen(saveName,'w');
%Print intro
introtext = '<?xml version="1.0" encoding="UTF-8"?><TrackMate version="6.0.1">  <Log></Log>  <Model spatialunits="Âµm" timeunits="frame">    <FeatureDeclarations>      <SpotFeatures>        <Feature feature="QUALITY" name="Quality" shortname="Quality" dimension="QUALITY" isint="false" />        <Feature feature="POSITION_X" name="X" shortname="X" dimension="POSITION" isint="false" />        <Feature feature="POSITION_Y" name="Y" shortname="Y" dimension="POSITION" isint="false" />        <Feature feature="POSITION_Z" name="Z" shortname="Z" dimension="POSITION" isint="false" />        <Feature feature="POSITION_T" name="T" shortname="T" dimension="TIME" isint="false" />        <Feature feature="FRAME" name="Frame" shortname="Frame" dimension="NONE" isint="true" />        <Feature feature="RADIUS" name="Radius" shortname="R" dimension="LENGTH" isint="false" />        <Feature feature="VISIBILITY" name="Visibility" shortname="Visibility" dimension="NONE" isint="true" />        <Feature feature="MANUAL_COLOR" name="Manual spot color" shortname="Spot color" dimension="NONE" isint="true" />        <Feature feature="MEAN_INTENSITY" name="Mean intensity" shortname="Mean" dimension="INTENSITY" isint="false" />        <Feature feature="MEDIAN_INTENSITY" name="Median intensity" shortname="Median" dimension="INTENSITY" isint="false" />        <Feature feature="MIN_INTENSITY" name="Minimal intensity" shortname="Min" dimension="INTENSITY" isint="false" />        <Feature feature="MAX_INTENSITY" name="Maximal intensity" shortname="Max" dimension="INTENSITY" isint="false" />        <Feature feature="TOTAL_INTENSITY" name="Total intensity" shortname="Total int." dimension="INTENSITY" isint="false" />        <Feature feature="STANDARD_DEVIATION" name="Standard deviation" shortname="Stdev." dimension="INTENSITY" isint="false" />        <Feature feature="ESTIMATED_DIAMETER" name="Estimated diameter" shortname="Diam." dimension="LENGTH" isint="false" />        <Feature feature="CONTRAST" name="Contrast" shortname="Constrast" dimension="NONE" isint="false" />        <Feature feature="SNR" name="Signal/Noise ratio" shortname="SNR" dimension="NONE" isint="false" />      </SpotFeatures>      <EdgeFeatures>        <Feature feature="SPOT_SOURCE_ID" name="Source spot ID" shortname="Source ID" dimension="NONE" isint="true" />        <Feature feature="SPOT_TARGET_ID" name="Target spot ID" shortname="Target ID" dimension="NONE" isint="true" />        <Feature feature="LINK_COST" name="Link cost" shortname="Cost" dimension="NONE" isint="false" />        <Feature feature="EDGE_TIME" name="Time (mean)" shortname="T" dimension="TIME" isint="false" />        <Feature feature="EDGE_X_LOCATION" name="X Location (mean)" shortname="X" dimension="POSITION" isint="false" />        <Feature feature="EDGE_Y_LOCATION" name="Y Location (mean)" shortname="Y" dimension="POSITION" isint="false" />        <Feature feature="EDGE_Z_LOCATION" name="Z Location (mean)" shortname="Z" dimension="POSITION" isint="false" />        <Feature feature="VELOCITY" name="Velocity" shortname="V" dimension="VELOCITY" isint="false" />        <Feature feature="DISPLACEMENT" name="Displacement" shortname="D" dimension="LENGTH" isint="false" />        <Feature feature="MANUAL_COLOR" name="Manual edge color" shortname="Edge color" dimension="NONE" isint="true" />      </EdgeFeatures>      <TrackFeatures>        <Feature feature="NUMBER_SPOTS" name="Number of spots in track" shortname="N spots" dimension="NONE" isint="true" />        <Feature feature="NUMBER_GAPS" name="Number of gaps" shortname="Gaps" dimension="NONE" isint="true" />        <Feature feature="LONGEST_GAP" name="Longest gap" shortname="Longest gap" dimension="NONE" isint="true" />        <Feature feature="NUMBER_SPLITS" name="Number of split events" shortname="Splits" dimension="NONE" isint="true" />        <Feature feature="NUMBER_MERGES" name="Number of merge events" shortname="Merges" dimension="NONE" isint="true" />        <Feature feature="NUMBER_COMPLEX" name="Complex points" shortname="Complex" dimension="NONE" isint="true" />        <Feature feature="TRACK_DURATION" name="Duration of track" shortname="Duration" dimension="TIME" isint="false" />        <Feature feature="TRACK_START" name="Track start" shortname="T start" dimension="TIME" isint="false" />        <Feature feature="TRACK_STOP" name="Track stop" shortname="T stop" dimension="TIME" isint="false" />        <Feature feature="TRACK_DISPLACEMENT" name="Track displacement" shortname="Displacement" dimension="LENGTH" isint="false" />        <Feature feature="TRACK_INDEX" name="Track index" shortname="Index" dimension="NONE" isint="true" />        <Feature feature="TRACK_ID" name="Track ID" shortname="ID" dimension="NONE" isint="true" />        <Feature feature="TRACK_X_LOCATION" name="X Location (mean)" shortname="X" dimension="POSITION" isint="false" />        <Feature feature="TRACK_Y_LOCATION" name="Y Location (mean)" shortname="Y" dimension="POSITION" isint="false" />        <Feature feature="TRACK_Z_LOCATION" name="Z Location (mean)" shortname="Z" dimension="POSITION" isint="false" />        <Feature feature="TRACK_MEAN_SPEED" name="Mean velocity" shortname="Mean V" dimension="VELOCITY" isint="false" />        <Feature feature="TRACK_MAX_SPEED" name="Maximal velocity" shortname="Max V" dimension="VELOCITY" isint="false" />        <Feature feature="TRACK_MIN_SPEED" name="Minimal velocity" shortname="Min V" dimension="VELOCITY" isint="false" />        <Feature feature="TRACK_MEDIAN_SPEED" name="Median velocity" shortname="Median V" dimension="VELOCITY" isint="false" />        <Feature feature="TRACK_STD_SPEED" name="Velocity standard deviation" shortname="V std" dimension="VELOCITY" isint="false" />        <Feature feature="TRACK_MEAN_QUALITY" name="Mean quality" shortname="Mean Q" dimension="QUALITY" isint="false" />        <Feature feature="TRACK_MAX_QUALITY" name="Maximal quality" shortname="Max Q" dimension="QUALITY" isint="false" />        <Feature feature="TRACK_MIN_QUALITY" name="Minimal quality" shortname="Min Q" dimension="QUALITY" isint="false" />        <Feature feature="TRACK_MEDIAN_QUALITY" name="Median quality" shortname="Median Q" dimension="QUALITY" isint="false" />        <Feature feature="TRACK_STD_QUALITY" name="Quality standard deviation" shortname="Q std" dimension="QUALITY" isint="false" />      </TrackFeatures>    </FeatureDeclarations>';
fprintf(fid,introtext);


%"<AllSpots nspots="1032">"
t = ['<AllSpots nspots="' num2str(nrlocs) '">'];
fprintf(fid,t);

locid = 1;
%Now loop over the frames
for fr = 1:max(loclist(:,1))
    t = ['<SpotsInFrame frame="' num2str(fr-1) '">'];
    fprintf(fid,t);
    frarr = loclist(loclist(:,1)==fr,:);
    for l = 1:size(frarr,1)
        t = ['<Spot ID="' num2str(locid) '" name="ID' num2str(locid) '" QUALITY="1" POSITION_T="' num2str(fr-1) '" MAX_INTENSITY="1" FRAME="' num2str(fr-1) '" MEDIAN_INTENSITY="1" VISIBILITY="1" MEAN_INTENSITY="1" TOTAL_INTENSITY="1" ESTIMATED_DIAMETER="1" RADIUS="0.1" SNR="1" POSITION_X="' num2str(frarr(l,2)) '" POSITION_Y="' num2str(frarr(l,3)) '" STANDARD_DEVIATION="1" CONTRAST="1" MANUAL_COLOR="-10921639" MIN_INTENSITY="1" POSITION_Z="0.0" />\r\n'];
        fprintf(fid,t);
        locid = locid+1;
    end
    fprintf(fid,'</SpotsInFrame>');
end
fprintf(fid,'</AllSpots>');
%midthing
fprintf(fid,'     <AllTracks />     <FilteredTracks />   </Model>   <Settings>');
t = ['<ImageData filename="DOESNOTEXIST.tif" folder="" width="' num2str(maxx+1) '" height="' num2str(maxy+1) '" nslices="1" nframes="50" pixelwidth="' num2str(pxsize) '" pixelheight="' num2str(pxsize) '" voxeldepth="1.0" timeinterval="1.0" />'];
fprintf(fid,t);
t = ['<BasicSettings xstart="0" xend="' num2str(maxx) '" ystart="0" yend="' num2str(maxx) '" zstart="0" zend="0" tstart="0" tend="' num2str(max(loclist(:,1))-1) '" />'];
fprintf(fid,t);

%outro
t = '     <DetectorSettings DETECTOR_NAME="LOG_DETECTOR" TARGET_CHANNEL="1" RADIUS="1.0" THRESHOLD="3.0" DO_MEDIAN_FILTERING="false" DO_SUBPIXEL_LOCALIZATION="true" />     <InitialSpotFilter feature="QUALITY" value="0.0" isabove="true" />     <SpotFilterCollection />     <TrackerSettings TRACKER_NAME="SIMPLE_SPARSE_LAP_TRACKER" CUTOFF_PERCENTILE="0.9" ALTERNATIVE_LINKING_COST_FACTOR="1.05" BLOCKING_VALUE="Infinity">       <Linking LINKING_MAX_DISTANCE="3.0">         <FeaturePenalties />       </Linking>       <GapClosing ALLOW_GAP_CLOSING="true" GAP_CLOSING_MAX_DISTANCE="0.0" MAX_FRAME_GAP="0">         <FeaturePenalties />       </GapClosing>       <TrackSplitting ALLOW_TRACK_SPLITTING="false" SPLITTING_MAX_DISTANCE="15.0">         <FeaturePenalties />       </TrackSplitting>       <TrackMerging ALLOW_TRACK_MERGING="false" MERGING_MAX_DISTANCE="15.0">         <FeaturePenalties />       </TrackMerging>     </TrackerSettings>     <TrackFilterCollection />     <AnalyzerCollection>       <SpotAnalyzers>         <Analyzer key="MANUAL_SPOT_COLOR_ANALYZER" />         <Analyzer key="Spot descriptive statistics" />         <Analyzer key="Spot radius estimator" />         <Analyzer key="Spot contrast and SNR" />       </SpotAnalyzers>       <EdgeAnalyzers>         <Analyzer key="Edge target" />         <Analyzer key="Edge mean location" />         <Analyzer key="Edge velocity" />         <Analyzer key="MANUAL_EDGE_COLOR_ANALYZER" />       </EdgeAnalyzers>       <TrackAnalyzers>         <Analyzer key="Branching analyzer" />         <Analyzer key="Track duration" />         <Analyzer key="Track index" />         <Analyzer key="Track location" />         <Analyzer key="Velocity" />         <Analyzer key="TRACK_SPOT_QUALITY" />       </TrackAnalyzers>     </AnalyzerCollection>   </Settings>   <GUIState state="ChooseTracker">     <View key="HYPERSTACKDISPLAYER" />   </GUIState> </TrackMate>';
fprintf(fid,t);

fclose(fid);
end